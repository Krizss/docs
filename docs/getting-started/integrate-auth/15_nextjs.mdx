---
id: nextjs
title: Integrate authentication into Next.js
sidebar_label: Next.js
---

```mdx-code-block
import Teaser from '../_common/teaser.mdx'
import mp4 from '../_static/nextjs/screencast.mp4'
import webm from '../_static/nextjs/screencast.webm'

<Teaser
  framework={<a href="https://nextjs.org">Next.js</a>}
  mp4={mp4}
  webm={webm}
/>
```

## Create Next.js app

First, create a new Next.js project. Run:

```shell
npx create-next-app@latest
cd app-name
```

When prompted, select the following options:

- Use TypeScript: Yes
- Use ESLint: Yes
- Use Tailwind CSS: Yes
- Use `src/` directory: No
- Use App Router: Yes
- Customize the default import alias: No

## Create a new Ory project

```mdx-code-block
import CreateProject from '../_common/create-project.mdx'

<CreateProject />
```

## Add Ory URL to environment variables

Add the following environment variables to your `.env` file:

```
NEXT_PUBLIC_ORY_SDK_URL=https://$PROJECT_SLUG.projects.oryapis.com
```

## Install Ory SDK

To interact with Ory's APIs we install the Ory SDK:

```shell
npm i --save @ory/elements-react @ory/nextjs
```

## Authenticate user

To implement authentication, create the following files:

```mdx-code-block
import oryConfig from '!!raw-loader!../../../code-examples/protect-page-login/nextjs/ory.config.ts'
import CodeBlock from '@theme/CodeBlock'

<CodeBlock language="tsx" title="ory.config.ts">{oryConfig}</CodeBlock>
```

This configuration file defines the paths for login, registration, and other authentication pages in your Next.js application.

```mdx-code-block
import middleware from '!!raw-loader!../../../code-examples/protect-page-login/nextjs/middleware.ts'

<CodeBlock language="tsx" title="middleware.ts">{middleware}</CodeBlock>
```

The middleware protects your routes by checking for valid sessions and redirecting unauthenticated users to the login page.

```mdx-code-block
import loginPage from '!!raw-loader!../../../code-examples/protect-page-login/nextjs/app/auth/login/page.tsx'

<CodeBlock language="tsx" title="app/auth/login/page.tsx">{loginPage}</CodeBlock>
```

The login page uses Ory's pre-built Login component to render a complete authentication form with error handling.

## Run your Next.js app

Now that your app is ready, it's time to run it! Start the Next.js development server:

```shell
npm run dev
```

Go to [localhost:3000](http://localhost:3000/) to access your application.

## Make authenticated calls to your API

To make authenticated API calls in your Next.js app, you can create a Route Handler that verifies the session:

```mdx-code-block
import route from '!!raw-loader!../../../code-examples/protect-page-login/nextjs/app/api/hello/route.ts'

<CodeBlock language="tsx" title="middleware.ts">{route}</CodeBlock>
```

When making API calls from client components, make sure to include credentials to send session cookies:

```tsx
// Client component example
const response = await fetch("/api/hello", {
  credentials: "include", // Important for sending cookies
})
```

### See it in action

Access your Next.js app at [localhost:3000](http://localhost:3000/), sign in, and see if you can make authenticated requests to
your API!

## Go to production

To promote this app to production:

1. Build the Next.js app and deploy it (for example on Vercel or Netlify)
2. Connect your project with a [custom domain](../../guides/custom-domains.mdx)

These components must be hosted on the same top-level domain as they were on your local machine:

| Component   | Production      | Local          |
| ----------- | --------------- | -------------- |
| Next.js App | www.example.org | localhost:3000 |
| Ory         | ory.example.org | localhost:4000 |
